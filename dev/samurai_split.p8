pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
function _init()
	game_manager = {
																	p1_score_pos = {x=50, y=25},
																	p2_score_pos = {x=75, y=25},
																	sprite_cylinder = 70,
																	game_states = {"play","menu","wait"},
																	current_state = "play",
																	wait_time = 25
																}
 p1 =	{
    			sprite = 1,
    			score = 0,
    			x = 25,
    			y = 50,
    			collider={x=25,y=50,w=8,h=8},
    			bullet_spawned = false,
    			bullets_left = 6
    		}
    
 p2 = {
		     sprite = 16,
		     score = 0,
		     collider={x=100,y=50,w=8,h=8},
	      sword = {can_atk=true,between_time=25,atk_time=5,collider={x=99,y=50,w=8,h=8}},
	      stimer = 0,
		     ani_speed = 1,
		     f_frame = 16,  -- first frame
		     l_frame = 19,  -- last frame
		     atk_window = false,
		     playing = false  -- new flag to track if animation is currently playing
    		}
    		
	bullet = {
   								sprite = 15,
   								x = p1.x + 2,
   								y = 51,
   								speed = 9,
   								destroyed = false,
 										collider={x=p1.x ,y=51, w=8,h=8}  							
   							}
	   									
end 

function _update()
if game_manager.current_state == "play" then
	game_manager.wait_time -= 1
	--if game_manager.wait_time < 0 then
	
end
-- controls for play state --
	if game_manager.current_state == "play" then
	-- p1 controls --
		if btnp(üÖæÔ∏è,0) and  
					p1.bullet_spawned == false and
					game_manager.wait_time < 0 then
			p1.bullet_spawned = true
			p1.bullets_left -= 1
			game_manager.sprite_cylinder -=1
			sfx(0)
		end
		if btnp(‚ùé,0) and
					p1.bullets_left > 1 and 
					game_manager.wait_time < 0 then
			p1.bullets_left -=1
			game_manager.sprite_cylinder -=1
			sfx(0)
		end
	-- end of p1 controls -- 
	
	-- p2 controls --
		if btnp(‚ùé,1) and 
		p2.playing == false and
		p2.sword.can_atk == true then 
			p2.playing = true
			p2.sword.can_atk = false
			p2.atk_window = true
			sfx(1)
		end
		
		if p2.atk_window == true then
			p2.sword.atk_time -= 1
			if p2.sword.atk_time < 0 then
				p2.sword.atk_time = 5
				p2.atk_window = false
			end
		end
		
		if p2.sword.can_atk == false then
			p2.sword.between_time -= 1
			
			if p2.sword.between_time < 0 then
				p2.sword.between_time = 25
				p2.sword.can_atk = true
			end
		end
		
		if p2.playing  then
			p2.sprite += 1
			if p2.sprite > p2.l_frame then
				p2.sprite = p2.f_frame
				p2.playing = false
			end
		end	
	-- end of p2 controls --
	
		 if p1.bullet_spawned == true then
	        bullet.x += bullet.speed
	        bullet.collider.x = bullet.x
	        
	  -- update sword collider position during attack animation
	  if p2.playing and p2.sprite >= 17 then  -- only active during certain frames
	  	p2.sword.collider.x = 92  -- extended forward position
	   p2.sword.collider.w = 12  -- wider hitbox during swing
	  else
	   p2.sword.collider.x = 98  -- default position
	   p2.sword.collider.w = 8   -- normal width
	  end
	
	  if bullet.destroyed == false then
				-- check sword collision first (priority during attack)
	  	if p2.atk_window and check_collision(bullet.collider, p2.sword.collider) then
	   	bullet.destroyed = true
	    p2.score += 1
	    game_manager.current_state = "wait"
	    -- p1.bullet_spawned = false
	    sfx(2)
	 		-- then check player collision
	   elseif check_collision(bullet.collider, p2.collider) then
	    p1.score += 1
	    bullet.destroyed = true
	    game_manager.current_state = "wait"
	    -- p1.bullet_spawned = false
	   end
	  end
	       
	   -- bullet boundary check
	   -- if bullet.x > 128 or bullet.destroyed then
	 	--   bullet.x = p1.x + 3
	    -- bullet.collider.x = bullet.x
	    -- bullet.destroyed = false
	    -- p1.bullet_spawned = false
	   --  end
	 end
	end
-- end of controls for play state --

-- controls for wait state --
	if game_manager.current_state == "wait" then
		if btnp(‚ùé,0) or btnp(üÖæÔ∏è,1) then
			game_manager.current_state = "play"
			p1.bullet_spawned = false
   p1.bullets_left = 6
   game_manager.sprite_cylinder = 70
   bullet.destroyed = false
   bullet.x = p1.x + 2
   bullet.collider.x = bullet.x			
		end
		game_manager.wait_time = 50
	end
-- end of controls for wait state --
end

function _draw()
	cls()
 map()
-- draw p1 sprite --
 spr(p1.sprite, p1.x, p1.y)
-- draw p2 sprite --
 spr(p2.sprite, 100, 50)
-- draw score to screen --
 print(p1.score,game_manager.p1_score_pos.x,game_manager.p1_score_pos.y,7)
 print(p2.score,game_manager.p2_score_pos.x,game_manager.p2_score_pos.y,7)
-- draw bullet to screen -- 
 if p1.bullet_spawned == true and
    bullet.destroyed == false then
 	spr(bullet.sprite,bullet.x,bullet.y,1,1,false,false)
 end
-- draw revolver cylinder to screen --
	spr(game_manager.sprite_cylinder,27,60,1,1,false,false )
-- draw next round to screen -
	if game_manager.current_state == "wait" then
		print("any player press üÖæÔ∏è", 25,100,8)
		print("to start next round", 25,115,8)
	end 
-- debug code -- 
--    rect(p2.collider.x, p2.collider.y, p2.collider.x+p2.collider.w, p2.collider.y+p2.collider.h, 8)
--if p2.atk_window then
  --  rect(p2.sword.collider.x, p2.sword.collider.y, 
  --        p2.sword.collider.x+p2.sword.collider.w, 
  --        p2.sword.collider.y+p2.sword.collider.h, 9)
--end
	--print("atk_time:"..p2.sword.atk_time, 10, 10)
    
	--print("current_state:"..game_manager.current_state,15,15)
--   print("wait_time:"..game_manager.wait_time, 50,50,7)
-- end of debug code --
end

function check_collision(a,b)
	return a.x < b.x + b.w and
								a.x + a.w > b.x and
								a.y < b.y + b.h and
								a.y + a.h > b.y
end
__gfx__
00000000000044000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700000007700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009a
00077000000077dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000077d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000066000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000006500500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00099000000099000000990000009900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00999900000999900009999000099990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000000770000007700d0007700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0077700000077700000777000d077700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00477000000477000000770000d07700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00066d0000d06600ddd4660000046600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000660d00d0766000007660000076600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00500500005500500055005000550050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00555000005550000055500000555000005550000055500000555000000000000000000000000000000000000000000000000000ff4444ffffffffffffffffff
055d5500055a5500055a5500055a5500055a5500055a5500055a5500000000000000000000000000000000000000000000000000f4cccc4fffffffffffffffff
5d555d505d555d505a555d505a555d505a555d505a555d505a555a50000000000000000000000000000000000000000000000000f4cccc4ffffffffffff33fff
55565550555655505556555055565550555655505556555055565550000000000000000000000000000000000000000000000000f444444ff4ff4f4ff3f33f3f
5d555d505d555d505d555d505a555d505a555d505a555a505a555a50000000000000000000000000000000000000000000000000f454454fff4f44fff333333f
055d5500055d5500055d5500055d5500055a5500055a5500055a5500000000000000000000000000000000000000000000000000f454454ffff4fffffff33fff
00555000005550000055500000555000005550000055500000555000000000000000000000000000000000000000000000000000ff4444ffff4f4ffffff33fff
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffff4f
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffff4fffff
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f747747ffffffffffffff9ff
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000777477474fff4ff4afffffff
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f6774747f4ff4f4fffffffaf
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f6774746ff44ffffffffffff
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044dd4d4dffff44ffff9f4ff9
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f55ff55ffff4ff4fffffffff
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffff
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffafffff
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffff
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffff99ff
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffff
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fffffffffaffff4f
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffff
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffff4fffff
__map__
6e6f6e5f6f6e6e6f6e6e6e4e6e5f5f6e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4f4d5d6e5e5d4d6e4e4d5d4f6e5d4d4f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6e6e6e6e6e6e6e6e6e6e6e6e6e6e6e6e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6e6f6e6e4f6e6e6e6e6e6e6e6e6e6e6e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6e6e6e6f6e6e6e6e6e6f6f6e6e5e6e6e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6e6e6e6e6e6e6e4e6e6e6e6e6e6e6e6e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6e6e4e6e6e6e6e6e6e6e6e6e6e6e6e6f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6e6e6e6e6e6e6e6e6e6e6e6e6e6e6e6e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6e6e6e6e6e6e6e5f6e6e6e6f6e6e6e6e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6e6e4f6e6f6e5f6e6e5f6f5f6e6e4f6e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6e6e6e6e6e6e6e6e6e6e6e6e6e6e6e6e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6e6e6e6e6e6e6e6e4f6e6e6e6e6e6e6e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6e6e6e6e6f6e6e6e6e6e6e6f4f6e4e6e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6e4f6e6e6e6e6e6e6e6e6e6e6e6e6e6e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6e6e6e6e6e6f6e6e6e4f6e5f6e6e6e6e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6e6e6f6e6e6e6e6e6e6e6e6e6e6e6e4e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
00010000066500765008650086500965009650096500a6500a6500875008750087500875008750077500a7500775006750057500a750057500375008750027500175000750047500375001750007501260012600
0001000003750087500a7500e7500d750107501575016750187501a75012750107500b750077501770016700167001570015700147001370013700127001270011700107000f7000f7000e7000e7000e7000e700
00010000243501c6501b6501a6501335012350103500e3500c3500835005350043500035008650066500465002650016500065001650000000000000000000000000000000000000000000000000000000000000
